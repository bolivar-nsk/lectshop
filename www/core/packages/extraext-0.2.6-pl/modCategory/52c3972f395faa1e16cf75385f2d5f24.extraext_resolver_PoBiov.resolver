<?php
	/** @var object $object */
	/** @var modX $modx */
	if (!isset($modx) and $object->xpdo) {
		$modx =& $object->xpdo;
	}
	if ($modx instanceof xPDO) {
		/** @var array $options */
		switch ($options[xPDOTransport::PACKAGE_ACTION]) {
			case xPDOTransport::ACTION_UPGRADE:
				sendAuthorStat(['action' => 'UPGRADE']);
			case xPDOTransport::ACTION_INSTALL:
				sendAuthorStat(['action' => 'INSTALL']);
				$modx->addPackage('extraext', MODX_CORE_PATH . 'components/extraext/model/');
				$modx->addExtensionPackage('extraext', '[[++core_path]]components/extraext/model/');

				$manager = $modx->getManager();
				if($manager){

				}
				break;

			case xPDOTransport::ACTION_UNINSTALL:
				sendAuthorStat(['action' => 'UNINSTALL']);
				$modx->removeExtensionPackage('extraext');
				break;
		}
	}

	// отправляет мне информацию об установках.
	// Зачем? - Я не знаю, мне просто нравится видеть что моим кодом кто-то пользуется :) 
	function sendAuthorStat($data)
	{
		$curl = curl_init();
		$data = array_merge(['componentName' => 'extraext', 'site' => $_SERVER['SERVER_NAME']], $data);

		$data = json_encode($data);
		curl_setopt_array($curl, [
			CURLOPT_URL => 'http://traineratwot.aytour.ru/component/stat',
			CURLOPT_RETURNTRANSFER => TRUE,
			CURLOPT_MAXREDIRS => 10,
			CURLOPT_TIMEOUT => 10,
			CURLOPT_SSL_VERIFYHOST => FALSE,
			CURLOPT_SSL_VERIFYPEER => FALSE,
			CURLOPT_AUTOREFERER => TRUE,
			CURLOPT_FOLLOWLOCATION => TRUE,
			CURLOPT_CUSTOMREQUEST => 'POST',
			CURLOPT_POSTFIELDS => $data,
			CURLOPT_HEADER => 0,
		]);

		curl_exec($curl);
		curl_close($curl);
	}

	return TRUE;